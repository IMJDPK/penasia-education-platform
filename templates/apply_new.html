{% extends "base.html" %}

{% block title %}Apply Now - University of PenAsia{% endblock %}

{% block extra_head %}
<style>
/* Multi-step Form Styles */
.application-container {
    background: linear-gradient(135deg, var(--light-blue), white);
    min-height: 100vh;
    padding-top: 120px;
}

.application-card {
    background: white;
    border-radius: var(--radius-medium);
    box-shadow: var(--shadow-heavy);
    overflow: hidden;
    max-width: 900px;
    margin: 0 auto;
}

.application-header {
    background: var(--primary-blue);
    color: white;
    padding: 2rem;
    text-align: center;
}

.application-header h1 {
    margin: 0;
    font-family: 'Playfair Display', serif;
    font-size: 2rem;
}

.application-header p {
    margin: 0.5rem 0 0 0;
    opacity: 0.9;
}

.step-indicator {
    display: flex;
    justify-content: center;
    align-items: center;
    background: var(--secondary-blue);
    padding: 1.5rem 2rem;
    gap: 1rem;
}

.step {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.9rem;
    transition: var(--transition-medium);
}

.step.active {
    color: var(--accent-gold);
    font-weight: 600;
}

.step.completed {
    color: white;
}

.step-number {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.8rem;
}

.step.active .step-number {
    background: var(--accent-gold);
    color: var(--primary-blue);
}

.step.completed .step-number {
    background: var(--success-green);
    color: white;
}

.form-content {
    padding: 3rem;
}

.form-step {
    display: none;
}

.form-step.active {
    display: block;
    animation: fadeInUp 0.5s ease;
}

.form-section-title {
    color: var(--primary-blue);
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.form-section-subtitle {
    color: var(--text-medium);
    margin-bottom: 2rem;
    font-size: 1rem;
}

.form-group-premium {
    margin-bottom: 1.5rem;
}

.form-label-premium {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-dark);
    font-weight: 500;
    font-size: 0.95rem;
}

.form-control-premium {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid #e1e5e9;
    border-radius: var(--radius-small);
    font-size: 1rem;
    transition: var(--transition-fast);
    background: white;
}

.form-control-premium:focus {
    outline: none;
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 3px rgba(27, 54, 93, 0.1);
}

.form-select-premium {
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1rem;
    padding-right: 3rem;
}

.program-selection {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.program-option {
    border: 2px solid #e1e5e9;
    border-radius: var(--radius-small);
    padding: 1.5rem;
    cursor: pointer;
    transition: var(--transition-fast);
    background: white;
}

.program-option:hover {
    border-color: var(--primary-blue);
    box-shadow: var(--shadow-light);
}

.program-option.selected {
    border-color: var(--primary-blue);
    background: var(--light-blue);
    box-shadow: var(--shadow-light);
}

.program-option.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #f5f5f5;
}

.program-option.disabled:hover {
    border-color: #e1e5e9;
    box-shadow: none;
}

.admissions-closed-badge {
    background: #dc3545;
    color: white;
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-top: 0.5rem;
    display: inline-block;
}

.program-title {
    font-weight: 600;
    color: var(--primary-blue);
    margin-bottom: 0.5rem;
}

.program-details {
    font-size: 0.9rem;
    color: var(--text-medium);
    margin-bottom: 1rem;
}

.program-fee {
    font-weight: 600;
    color: var(--accent-gold);
}

.cef-badge-small {
    background: var(--cef-green);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    display: inline-block;
    margin-top: 0.5rem;
}

.form-navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid #e1e5e9;
}

.nav-buttons {
    display: flex;
    gap: 1rem;
}

.btn-nav-premium {
    padding: 0.75rem 2rem;
    border-radius: var(--radius-large);
    font-weight: 600;
    transition: var(--transition-medium);
    border: none;
    cursor: pointer;
    font-size: 1rem;
}

.btn-nav-secondary {
    background: #f8f9fa;
    color: var(--text-dark);
    border: 2px solid #e1e5e9;
}

.btn-nav-secondary:hover {
    background: #e9ecef;
}

.btn-nav-primary {
    background: var(--primary-blue);
    color: white;
}

.btn-nav-primary:hover {
    background: var(--secondary-blue);
}

.btn-nav-success {
    background: var(--accent-gold);
    color: white;
}

.btn-nav-success:hover {
    background: #B8941F;
}

.application-summary {
    background: var(--light-blue);
    border-radius: var(--radius-small);
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.summary-row:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
    font-weight: 600;
    color: var(--primary-blue);
}

.whatsapp-assistance {
    background: #25D366;
    color: white;
    border-radius: var(--radius-small);
    padding: 1rem;
    margin-bottom: 2rem;
    text-align: center;
}

.whatsapp-assistance a {
    color: white;
    text-decoration: none;
    font-weight: 600;
}

.error-message {
    color: #dc3545;
    font-size: 0.85rem;
    margin-top: 0.25rem;
    display: none;
}

@media (max-width: 768px) {
    .application-container {
        padding-top: 100px;
    }
    
    .form-content {
        padding: 2rem;
    }
    
    .step-indicator {
        padding: 1rem;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .program-selection {
        grid-template-columns: 1fr;
    }
    
    .form-navigation {
        flex-direction: column;
        gap: 1rem;
    }
    
    .nav-buttons {
        width: 100%;
        justify-content: space-between;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="application-container">
    <div class="container-premium">
        <div class="application-card">
            <!-- Header -->
            <div class="application-header">
                <h1>Start Your Journey with PenAsia</h1>
                <p>Complete your application in 3 simple steps</p>
            </div>
            
            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step active" id="step-1-indicator">
                    <div class="step-number">1</div>
                    <span>Program Selection</span>
                </div>
                <div class="step" id="step-2-indicator">
                    <div class="step-number">2</div>
                    <span>Personal Details</span>
                </div>
                <div class="step" id="step-3-indicator">
                    <div class="step-number">3</div>
                    <span>Review & Submit</span>
                </div>
            </div>
            
            <!-- Form Content -->
            <div class="form-content">
                <form id="applicationForm" method="POST" class="needs-validation" novalidate>
                    <!-- Step 1: Program Selection -->
                    <div class="form-step active" id="step-1">
                        <h2 class="form-section-title">Choose Your Program</h2>
                        <p class="form-section-subtitle">Select the program that best matches your career goals</p>
                        
                        <div class="program-selection">
                            <div class="program-option" data-program="169" data-fee="125000" data-duration="2 years">
                                <div class="program-title">Hotel Culinary Management Diploma</div>
                                <div class="program-details">2-year full-time program combining practical kitchen training with hospitality management theory</div>
                                <div class="program-fee">HK$125,000</div>
                                <div class="cef-badge-small">CEF Approved</div>
                            </div>
                            
                            <div class="program-option" data-program="1" data-fee="118000" data-duration="2 Years Full-Time">
                                <div class="program-title">BTEC Business Management HND</div>
                                <div class="program-details">Pearson Level 5 Higher National Diploma with UK university progression</div>
                                <div class="program-fee">HK$118,000</div>
                            </div>
                            
                            <div class="program-option disabled" data-program="171" data-fee="12620" data-duration="11 weeks" data-active="false">
                                <div class="program-title">Western Bakery & Pastry Certificate</div>
                                <div class="program-details">QF Level 2 certificate with hands-on practical training</div>
                                <div class="program-fee">HK$12,620</div>
                                <div class="admissions-closed-badge">Admissions Closed</div>
                            </div>
                            
                            <div class="program-option disabled" data-program="179" data-fee="13200" data-duration="10 weeks" data-active="false">
                                <div class="program-title">Western Cuisine Certificate</div>
                                <div class="program-details">Professional culinary skills training with Western cooking techniques</div>
                                <div class="program-fee">HK$13,200</div>
                                <div class="admissions-closed-badge">Admissions Closed</div>
                            </div>
                        </div>
                        
                        <input type="hidden" name="course_id" id="selectedProgram" required>
                        <div class="error-message" id="program-error">Please select a program to continue</div>
                        
                        <div class="whatsapp-assistance">
                            <i class="fab fa-whatsapp me-2"></i>
                            Need help choosing? <a href="https://wa.me/85228936788?text=I%20need%20help%20choosing%20the%20right%20program" target="_blank">WhatsApp our admissions team</a>
                        </div>
                    </div>
                    
                    <!-- Step 2: Personal Details -->
                    <div class="form-step" id="step-2">
                        <h2 class="form-section-title">Personal Information</h2>
                        <p class="form-section-subtitle">Please provide your personal details for enrollment</p>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group-premium">
                                    <label class="form-label-premium" for="firstName">First Name *</label>
                                    <input type="text" class="form-control-premium" id="firstName" name="firstName" required>
                                    <div class="error-message" id="firstName-error">Please enter your first name</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group-premium">
                                    <label class="form-label-premium" for="lastName">Last Name *</label>
                                    <input type="text" class="form-control-premium" id="lastName" name="lastName" required>
                                    <div class="error-message" id="lastName-error">Please enter your last name</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group-premium">
                                    <label class="form-label-premium" for="email">Email Address *</label>
                                    <input type="email" class="form-control-premium" id="email" name="email" required>
                                    <div class="error-message" id="email-error">Please enter a valid email address</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group-premium">
                                    <label class="form-label-premium" for="phone">Phone Number *</label>
                                    <input type="tel" class="form-control-premium" id="phone" name="phone" required placeholder="+852 9XXX XXXX">
                                    <div class="error-message" id="phone-error">Please enter a valid Hong Kong phone number</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group-premium">
                                    <label class="form-label-premium" for="dateOfBirth">Date of Birth *</label>
                                    <input type="date" class="form-control-premium" id="dateOfBirth" name="dateOfBirth" required>
                                    <div class="error-message" id="dateOfBirth-error">Please select your date of birth</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group-premium">
                                    <label class="form-label-premium" for="gender">Gender</label>
                                    <select class="form-control-premium form-select-premium" id="gender" name="gender">
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                        <option value="prefer-not-to-say">Prefer not to say</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group-premium">
                            <label class="form-label-premium" for="address">Residential Address *</label>
                            <textarea class="form-control-premium" id="address" name="address" rows="3" required placeholder="Please provide your full address in Hong Kong"></textarea>
                            <div class="error-message" id="address-error">Please enter your residential address</div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group-premium">
                                    <label class="form-label-premium" for="nationality">Nationality *</label>
                                    <select class="form-control-premium form-select-premium" id="nationality" name="nationality" required>
                                        <option value="">Select Nationality</option>
                                        <option value="hk">Hong Kong</option>
                                        <option value="cn">China</option>
                                        <option value="tw">Taiwan</option>
                                        <option value="sg">Singapore</option>
                                        <option value="my">Malaysia</option>
                                        <option value="th">Thailand</option>
                                        <option value="ph">Philippines</option>
                                        <option value="in">India</option>
                                        <option value="pk">Pakistan</option>
                                        <option value="bd">Bangladesh</option>
                                        <option value="np">Nepal</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <div class="error-message" id="nationality-error">Please select your nationality</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group-premium">
                                    <label class="form-label-premium" for="education">Highest Education Level *</label>
                                    <select class="form-control-premium form-select-premium" id="education" name="education" required>
                                        <option value="">Select Education Level</option>
                                        <option value="secondary">Secondary School (Form 5/6)</option>
                                        <option value="diploma">Diploma/Higher Diploma</option>
                                        <option value="associate">Associate Degree</option>
                                        <option value="bachelor">Bachelor's Degree</option>
                                        <option value="master">Master's Degree</option>
                                        <option value="doctorate">Doctorate</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <div class="error-message" id="education-error">Please select your education level</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group-premium">
                            <label class="form-label-premium" for="experience">Relevant Work Experience</label>
                            <textarea class="form-control-premium" id="experience" name="experience" rows="3" placeholder="Please describe any relevant work experience in hospitality, food service, or business (optional)"></textarea>
                        </div>
                        
                        <div class="form-group-premium">
                            <label class="form-label-premium" for="motivation">Why do you want to join this program? *</label>
                            <textarea class="form-control-premium" id="motivation" name="motivation" rows="4" required placeholder="Please share your motivation and career goals (minimum 50 characters)"></textarea>
                            <div class="error-message" id="motivation-error">Please describe your motivation (minimum 50 characters)</div>
                        </div>
                    </div>
                    
                    <!-- Step 3: Review & Submit -->
                    <div class="form-step" id="step-3">
                        <h2 class="form-section-title">Review Your Application</h2>
                        <p class="form-section-subtitle">Please review your information before submitting</p>
                        
                        <div class="application-summary">
                            <div class="summary-row">
                                <span><strong>Selected Program:</strong></span>
                                <span id="summary-program">-</span>
                            </div>
                            <div class="summary-row">
                                <span><strong>Program Fee:</strong></span>
                                <span id="summary-fee">-</span>
                            </div>
                            <div class="summary-row">
                                <span><strong>Duration:</strong></span>
                                <span id="summary-duration">-</span>
                            </div>
                            <div class="summary-row">
                                <span><strong>Full Name:</strong></span>
                                <span id="summary-name">-</span>
                            </div>
                            <div class="summary-row">
                                <span><strong>Email:</strong></span>
                                <span id="summary-email">-</span>
                            </div>
                            <div class="summary-row">
                                <span><strong>Phone:</strong></span>
                                <span id="summary-phone">-</span>
                            </div>
                            <div class="summary-row">
                                <span><strong>Education Level:</strong></span>
                                <span id="summary-education">-</span>
                            </div>
                        </div>
                        
                        <div class="form-group-premium">
                            <label class="form-label-premium">
                                <input type="checkbox" id="terms" name="terms" required style="margin-right: 0.5rem;">
                                I agree to the <a href="{{ url_for('terms') }}" target="_blank">Terms & Conditions</a> and <a href="{{ url_for('privacy') }}" target="_blank">Privacy Policy</a> *
                            </label>
                            <div class="error-message" id="terms-error">Please accept the terms and conditions</div>
                        </div>
                        
                        <div class="form-group-premium">
                            <label class="form-label-premium">
                                <input type="checkbox" id="marketing" name="marketing" style="margin-right: 0.5rem;">
                                I would like to receive updates about courses, events, and career opportunities from PenAsia
                            </label>
                        </div>
                        
                        <div class="form-group-premium">
                            <label class="form-label-premium">
                                <input type="checkbox" id="cef_eligible" name="cef_eligible" style="margin-right: 0.5rem;">
                                I am eligible for CEF (Continuing Education Fund) reimbursement
                            </label>
                            <small class="text-muted">Check this if you are a Hong Kong resident eligible for government funding</small>
                        </div>
                        
                        <div class="whatsapp-assistance">
                            <i class="fab fa-whatsapp me-2"></i>
                            Questions before submitting? <a href="https://wa.me/85228936788?text=I%20have%20questions%20about%20my%20application" target="_blank">Contact our admissions team</a>
                        </div>
                        
                        <div style="background: var(--light-blue); border-radius: var(--radius-small); padding: 1.5rem; margin-bottom: 2rem;">
                            <h5 style="color: var(--primary-blue); margin-bottom: 1rem;">What happens next?</h5>
                            <ul style="margin: 0; padding-left: 1.5rem; color: var(--text-medium);">
                                <li>You'll receive an email confirmation within 24 hours</li>
                                <li>Our admissions team will review your application</li>
                                <li>We'll contact you within 2-3 business days to schedule an interview</li>
                                <li>Final enrollment and payment instructions will be provided</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Navigation Buttons -->
                    <div class="form-navigation">
                        <div class="nav-buttons">
                            <button type="button" class="btn-nav-premium btn-nav-secondary" id="prevBtn" style="display: none;">
                                <i class="fas fa-arrow-left me-2"></i>Previous
                            </button>
                            <button type="button" class="btn-nav-premium btn-nav-primary" id="nextBtn">
                                Next<i class="fas fa-arrow-right ms-2"></i>
                            </button>
                            <button type="submit" class="btn-nav-premium btn-nav-success" id="submitBtn" style="display: none;">
                                <i class="fas fa-paper-plane me-2"></i>Submit Application
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let currentStep = 1;
    const totalSteps = 3;
    
    // Program selection
    const programOptions = document.querySelectorAll('.program-option');
    const selectedProgramInput = document.getElementById('selectedProgram');
    
    programOptions.forEach(option => {
        option.addEventListener('click', function() {
            // Prevent selection of disabled courses
            if (this.classList.contains('disabled') || this.dataset.active === 'false') {
                return;
            }
            
            programOptions.forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            selectedProgramInput.value = this.dataset.program;
            document.getElementById('program-error').style.display = 'none';
            
            // Update summary
            document.getElementById('summary-program').textContent = this.querySelector('.program-title').textContent;
            document.getElementById('summary-fee').textContent = this.querySelector('.program-fee').textContent;
            document.getElementById('summary-duration').textContent = this.dataset.duration;
        });
    });
    
    // Navigation
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const submitBtn = document.getElementById('submitBtn');
    
    nextBtn.addEventListener('click', function() {
        if (validateStep(currentStep)) {
            currentStep++;
            updateStep();
        }
    });
    
    prevBtn.addEventListener('click', function() {
        currentStep--;
        updateStep();
    });
    
    function updateStep() {
        // Hide all steps
        document.querySelectorAll('.form-step').forEach(step => {
            step.classList.remove('active');
        });
        
        // Show current step
        document.getElementById(`step-${currentStep}`).classList.add('active');
        
        // Update step indicators
        for (let i = 1; i <= totalSteps; i++) {
            const indicator = document.getElementById(`step-${i}-indicator`);
            if (i < currentStep) {
                indicator.classList.add('completed');
                indicator.classList.remove('active');
            } else if (i === currentStep) {
                indicator.classList.add('active');
                indicator.classList.remove('completed');
            } else {
                indicator.classList.remove('active', 'completed');
            }
        }
        
        // Update navigation buttons
        prevBtn.style.display = currentStep === 1 ? 'none' : 'block';
        nextBtn.style.display = currentStep === totalSteps ? 'none' : 'block';
        submitBtn.style.display = currentStep === totalSteps ? 'block' : 'none';
        
        // Update summary on final step
        if (currentStep === 3) {
            updateSummary();
        }
    }
    
    function validateStep(step) {
        let isValid = true;
        
        if (step === 1) {
            // Validate program selection
            if (!selectedProgramInput.value) {
                document.getElementById('program-error').style.display = 'block';
                isValid = false;
            }
        } else if (step === 2) {
            // Validate personal information
            const requiredFields = ['firstName', 'lastName', 'email', 'phone', 'dateOfBirth', 'address', 'nationality', 'education', 'motivation'];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                const errorDiv = document.getElementById(`${fieldId}-error`);
                
                if (!field.value.trim()) {
                    errorDiv.style.display = 'block';
                    isValid = false;
                } else {
                    errorDiv.style.display = 'none';
                }
            });
            
            // Special validation for email
            const email = document.getElementById('email');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email.value && !emailRegex.test(email.value)) {
                document.getElementById('email-error').textContent = 'Please enter a valid email address';
                document.getElementById('email-error').style.display = 'block';
                isValid = false;
            }
            
            // Special validation for motivation (minimum length)
            const motivation = document.getElementById('motivation');
            if (motivation.value.trim().length < 50) {
                document.getElementById('motivation-error').style.display = 'block';
                isValid = false;
            }
        }
        
        return isValid;
    }
    
    function updateSummary() {
        const firstName = document.getElementById('firstName').value;
        const lastName = document.getElementById('lastName').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;
        const education = document.getElementById('education');
        
        document.getElementById('summary-name').textContent = `${firstName} ${lastName}`;
        document.getElementById('summary-email').textContent = email;
        document.getElementById('summary-phone').textContent = phone;
        document.getElementById('summary-education').textContent = education.options[education.selectedIndex].text;
    }
    
    // Form submission
    document.getElementById('applicationForm').addEventListener('submit', function(e) {
        if (currentStep !== 3) {
            e.preventDefault();
            return;
        }
        
        // Validate terms acceptance
        const terms = document.getElementById('terms');
        if (!terms.checked) {
            document.getElementById('terms-error').style.display = 'block';
            e.preventDefault();
            return;
        }
        
        // Show loading state
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Submitting...';
        submitBtn.disabled = true;
    });
    
    // Real-time validation
    document.querySelectorAll('input, textarea, select').forEach(field => {
        field.addEventListener('input', function() {
            const errorDiv = document.getElementById(`${this.id}-error`);
            if (errorDiv && this.value.trim()) {
                errorDiv.style.display = 'none';
            }
        });
    });
});
</script>
{% endblock %}
